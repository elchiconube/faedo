---
import Layout from '../../components/Layout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import MapLeaflet from '../../components/MapLeaflet.astro';
import Seo from '../../components/Seo.astro';
import { Image } from 'astro:assets';
import { getEntry } from 'astro:content';

const entry = await getEntry('rutas', 'faedo-de-cinera');
const data = entry.data;

const hikingTrailLd = {
  '@context': 'https://schema.org',
  '@type': 'HikingTrail',
  name: data.title,
  description: data.summary,
  url: new URL(Astro.url.pathname, Astro.site).toString(),
  image: data.coverImage.src,
  trailLength: { '@type': 'Distance', name: `${data.distance_km} km` },
  estimatedDuration: `PT${Math.round(data.duration_h)}H`,
  difficulty: data.difficulty,
  geo: { '@type': 'GeoCoordinates', latitude: data.start_coords.lat, longitude: data.start_coords.lng },
};

const attractionLd = {
  '@context': 'https://schema.org',
  '@type': 'TouristAttraction',
  name: 'Faedo de Ciñera',
  description: data.summary,
  url: new URL(Astro.url.pathname, Astro.site).toString(),
  image: data.coverImage.src,
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'Ciñera',
    addressRegion: 'León',
    addressCountry: 'ES',
  },
  geo: { '@type': 'GeoCoordinates', latitude: data.start_coords.lat, longitude: data.start_coords.lng },
};
---
<Layout title={`La Ruta: ${data.title}`} description={data.summary}>
  <Seo slot="head" title={`La Ruta: ${data.title}`} description={data.summary} type="place" jsonLd={[hikingTrailLd, attractionLd]} />
  <Breadcrumbs items={[{ href: '/', label: 'Inicio' }, { href: '/ruta/faedo-de-cinera', label: 'La Ruta' }]} />

  <section class="container py-6 grid lg:grid-cols-3 gap-8">
    <div class="lg:col-span-2 space-y-6">
      <div class="aspect-[16/9] rounded-lg overflow-hidden ring-1 ring-black/5">
        <Image src={data.coverImage} alt={`Hayedo del ${data.title}`} widths={[640,960,1280]} sizes="(max-width: 1024px) 100vw, 960px" />
      </div>
      <article class="prose prose-slate max-w-none">
        <h1>Ruta del Faedo de Ciñera</h1>
        <p>{data.summary}</p>
      </article>

      <section aria-labelledby="mapa">
        <h2 id="mapa" class="text-xl font-semibold mb-2">Mapa de la ruta</h2>
        <MapLeaflet lat={data.start_coords.lat} lng={data.start_coords.lng} zoom={14} height="380px" />
        <p class="mt-2 text-sm">Descarga el GPX: <a href="/gpx/faedo.gpx" download>faedo.gpx</a></p>
      </section>

      <section aria-labelledby="galeria">
        <h2 id="galeria" class="text-xl font-semibold mb-2">Galería</h2>
        <div class="grid sm:grid-cols-2 gap-3">
          {data.gallery.map((img, i) => (
            <Image src={img} alt={`Faedo de Ciñera foto ${i + 1}`} widths={[480,768,1024]} sizes="(max-width: 768px) 100vw, 50vw" />
          ))}
        </div>
      </section>
    </div>

    <aside class="lg:col-span-1 space-y-6">
      <section class="border rounded-lg p-4">
        <h2 class="font-semibold">Datos rápidos</h2>
        <ul class="mt-2 text-sm text-gray-700 space-y-1">
          <li><strong>Distancia:</strong> {data.distance_km} km</li>
          <li><strong>Desnivel:</strong> {data.elevation_m} m</li>
          <li><strong>Duración:</strong> {data.duration_h} h</li>
          <li><strong>Dificultad:</strong> {data.difficulty}</li>
          <li><strong>Temporada:</strong> {data.season}</li>
        </ul>
        <a href="#como-llegar" class="mt-3 inline-block text-sm">Cómo llegar</a>
      </section>

      <section id="como-llegar" class="border rounded-lg p-4">
        <h2 class="font-semibold">Cómo llegar</h2>
        <p class="mt-2 text-sm text-gray-700">{data.access}</p>
        <p class="mt-2 text-sm text-gray-700"><strong>Aparcamiento:</strong> {data.parking}</p>
        <a href="/gpx/faedo.gpx" class="mt-3 inline-block bg-primary-600 text-white px-3 py-2 rounded">Descargar GPX</a>
      </section>

      <section class="border rounded-lg p-4">
        <h2 class="font-semibold">Consejos</h2>
        <ul class="mt-2 text-sm text-gray-700 list-disc pl-5">
          <li>Ropa y calzado para terreno húmedo.</li>
          <li>Evita salirse de las pasarelas.</li>
          <li>Ruta apta para niños; vigilar cerca del arroyo.</li>
        </ul>
      </section>

      <section class="border rounded-lg p-4">
        <h2 class="font-semibold">Rutas cercanas</h2>
        <ul class="mt-2 text-sm text-gray-700 list-disc pl-5">
          <li><a href="/guia-visitantes">Otras rutas en la zona</a></li>
          <li><a href="/blog">Consejos para otoño</a></li>
        </ul>
      </section>
    </aside>
  </section>
</Layout>

